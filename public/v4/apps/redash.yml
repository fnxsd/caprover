caproverOneClickApp:
  description: ''
  displayName: redash
  documentation: ''
  instructions:
    end: Have fun!
    start: Install redash and start using it.
  isOfficial: false
  variables:
  - id: $$cap_app_version
    label: App Version
    description: Version of redash. See https://hub.docker.com/r/redash/redash/tags?page=1&ordering=last_updated for available versions.
    defaultValue: 10.1.0.b50633
  - defaultValue: "'redis://localhost:6379/0'"
    description: URL Redash services will use to read and write to redis
    id: $$cap_redis_url
    label: REDASH_REDIS_URL
  - defaultValue: "'false'"
    description: Whether to disable access to public URLs
    id: $$cap_disable_public_urls
    label: REDASH_DISABLE_PUBLIC_URLS
  - defaultValue: "'qq.com'"
    description: Comma separated of email domains that cannot create user accounts
    id: $$cap_blocked_domains
    label: REDASH_BLOCKED_DOMAINS
  - defaultValue: '1'
    description: "Passed to Werkzeug\u2019s\_ProxyFix\_to make sure we get the right  referral address even behind proxies like nginx."
    id: $$cap_proxies_count
    label: REDASH_PROXIES_COUNT
  - defaultValue: 127.0.0.1
    description: Host for STATSD daemon
    id: $$cap_statsd_host
    label: REDASH_STATSD_HOST
  - defaultValue: '8125'
    description: Port for STATSD daemon
    id: $$cap_statsd_port
    label: REDASH_STATSD_PORT
  - defaultValue: redash
    description: Prefix for metrics sent to STATSD daemon
    id: $$cap_statsd_prefix
    label: REDASH_STATSD_PREFIX
  - defaultValue: 'FALSE'
    description: "Whether to use tags in StatsD metrics (InfluxDB\u2019s format)"
    id: $$cap_statsd_use_tags
    label: REDASH_STATSD_USE_TAGS
  - defaultValue: postgresql://postgres
    description: URL the Redash server and worker services will use to access the
      metadata database
    id: $$cap_database_url
    label: REDASH_DATABASE_URL
  - defaultValue: 'TRUE'
    description: Whether the job to cleanup unused query results should run automatically
    id: $$cap_query_results_cleanup_enabled
    label: REDASH_QUERY_RESULTS_CLEANUP_ENABLED
  - defaultValue: '100'
    description: "The number of results to cleanup during each call to\_cleanup_query_results"
    id: $$cap_query_results_cleanup_count
    label: REDASH_QUERY_RESULTS_CLEANUP_COUNT
  - defaultValue: '7'
    description: Integer number of days, past which a query result may be cleaned
      up if it is not referenced by another query.
    id: $$cap_query_results_cleanup_max_age
    label: REDASH_QUERY_RESULTS_CLEANUP_MAX_AGE
  - defaultValue: '30'
    description: How often to refresh the data source schemas (in minutes)
    id: $$cap_schemas_refresh_schedule
    label: REDASH_SCHEMAS_REFRESH_SCHEDULE
  - defaultValue: api_key
    description: "May be either\_ api_key or hmax"
    id: $$cap_auth_type
    label: REDASH_AUTH_TYPE
  - defaultValue: 'FALSE'
    description: "This is passed to\_Flask-Talisman"
    id: $$cap_enforce_https
    label: REDASH_ENFORCE_HTTPS
  - defaultValue: 60 _ 60 _ 24 * 7
    description: An integer number of seconds after which an invitation link will
      expire
    id: $$cap_invitation_token_max_age
    label: REDASH_INVITATION_TOKEN_MAX_AGE
  - defaultValue: 'FALSE'
    description: "Whether to enable multi-org mode.\_Note: Multi-org mode is not documented  or supported at this time"
    id: $$cap_multi_org
    label: REDASH_MULTI_ORG
  - defaultValue: ''
    description: The client ID to use for Google Login, be sure to set a client secret
      as well
    id: $$cap_google_client_id
    label: REDASH_GOOGLE_CLIENT_ID
  - defaultValue: ''
    description: The client secret to use for Google Login, be sure to set a client
      id as well
    id: $$cap_google_client_secret
    label: REDASH_GOOGLE_CLIENT_SECRET
  - defaultValue: 'FALSE'
    description: "Enables the use of an externally-provided and trusted remote user  via an HTTP header. The 'user' must be an email address.\_More details"
    id: $$cap_remote_user_login_enabled
    label: REDASH_REMOTE_USER_LOGIN_ENABLED
  - defaultValue: X-Forwarded-Remote-User
    description: "Name of header to use if\_REDASH_REMOTE_USER_LOGIN_ENABLED is true"
    id: $$cap_remote_user_header
    label: REDASH_REMOTE_USER_HEADER
  - defaultValue: 'FALSE'
    description: ''
    id: $$cap_ldap_login_enabled
    label: REDASH_LDAP_LOGIN_ENABLED
  - defaultValue: None
    description: ''
    id: $$cap_ldap_url
    label: REDASH_LDAP_URL
  - defaultValue: None
    description: ''
    id: $$cap_ldap_bind_dn
    label: REDASH_LDAP_BIND_DN
  - defaultValue: ''
    description: ''
    id: $$cap_ldap_bind_dn_password
    label: REDASH_LDAP_BIND_DN_PASSWORD
  - defaultValue: displayName
    description: ''
    id: $$cap_ldap_display_name_key
    label: REDASH_LDAP_DISPLAY_NAME_KEY
  - defaultValue: mail
    description: ''
    id: $$cap_ldap_email_key
    label: REDASH_LDAP_EMAIL_KEY
  - defaultValue: 'LDAP/AD/SSO username:'
    description: ''
    id: $$cap_ldap_custom_username_prompt
    label: REDASH_LDAP_CUSTOM_USERNAME_PROMPT
  - defaultValue: (cn=%(username)s)
    description: ''
    id: $$cap_ldap_search_template
    label: REDASH_LDAP_SEARCH_TEMPLATE
  - defaultValue: REDASHSEARCHDN
    description: ''
    id: $$cap_ldap_search_dn
    label: REDASH_LDAP_SEARCH_DN
  - defaultValue: "'../client/dist/'"
    description: Directory that contains all front-end assets. Relative to the ./redash
      directory
    id: $$cap_static_assets_path
    label: REDASH_STATIC_ASSETS_PATH
  - defaultValue: 3600 * 12
    description: TTL in seconds for jobs placed in queue. If a job is not picked up
      by a worker within this TTL it will expire.
    id: $$cap_job_expiry_time
    label: REDASH_JOB_EXPIRY_TIME
  - defaultValue: ''
    description: "Required. Used for various cryptographic features of the web server.  Read more about how Redash uses secret keys\_here"
    id: $$cap_cookie_secret
    label: REDASH_COOKIE_SECRET
  - defaultValue: INFO
    description: "Logging messages which are less severe than level will be ignored.  Read more about Python logging\_here"
    id: $$cap_log_level
    label: REDASH_LOG_LEVEL
  - defaultValue: localhost
    description: ''
    id: $$cap_mail_server
    label: REDASH_MAIL_SERVER
  - defaultValue: '25'
    description: ''
    id: $$cap_mail_port
    label: REDASH_MAIL_PORT
  - defaultValue: 'FALSE'
    description: ''
    id: $$cap_mail_use_tls
    label: REDASH_MAIL_USE_TLS
  - defaultValue: 'FALSE'
    description: ''
    id: $$cap_mail_use_ssl
    label: REDASH_MAIL_USE_SSL
  - defaultValue: None
    description: ''
    id: $$cap_mail_username
    label: REDASH_MAIL_USERNAME
  - defaultValue: None
    description: ''
    id: $$cap_mail_password
    label: REDASH_MAIL_PASSWORD
  - defaultValue: None
    description: ''
    id: $$cap_mail_default_sender
    label: REDASH_MAIL_DEFAULT_SENDER
  - defaultValue: None
    description: ''
    id: $$cap_mail_max_emails
    label: REDASH_MAIL_MAX_EMAILS
  - defaultValue: 'FALSE'
    description: ''
    id: $$cap_mail_ascii_attachments
    label: REDASH_MAIL_ASCII_ATTACHMENTS
  - defaultValue: ''
    description: The URL host used in emails sent to users (invites, alerts, notifications)
      etc.
    id: $$cap_host
    label: REDASH_HOST
  - defaultValue: ({state}) {alert_name}
    description: "Subject used for email alert notifications.\_ {state} and {alert_name}   are the only available variables."
    id: $$cap_alerts_default_mail_subject_template
    label: REDASH_ALERTS_DEFAULT_MAIL_SUBJECT_TEMPLATE
  - defaultValue: 50/hour
    description: "The\_Flask-Limiter\_string pattern used to rate limit requests to  the /login route."
    id: $$cap_throttle_login_pattern
    label: REDASH_THROTTLE_LOGIN_PATTERN
  - defaultValue: REDIS_URL
    description: "Mapped directly to Flask-Limiter\u2019s\_storage_uri."
    id: $$cap_limiter_storage
    label: REDASH_LIMITER_STORAGE
  - defaultValue: ''
    description: ''
    id: $$cap_cors_access_control_allow_origin
    label: REDASH_CORS_ACCESS_CONTROL_ALLOW_ORIGIN
  - defaultValue: 'FALSE'
    description: ''
    id: $$cap_cors_access_control_allow_credentials
    label: REDASH_CORS_ACCESS_CONTROL_ALLOW_CREDENTIALS
  - defaultValue: GET, POST, PUT
    description: ''
    id: $$cap_cors_access_control_request_method
    label: REDASH_CORS_ACCESS_CONTROL_REQUEST_METHOD
  - defaultValue: Content-Type
    description: ''
    id: $$cap_cors_access_control_allow_headers
    label: REDASH_CORS_ACCESS_CONTROL_ALLOW_HEADERS
  - defaultValue: "','.join(defaultqueryrunners)"
    description: "Comma-separated list of query runners to be enabled (e.g.\_redash.query_runner.pg,redash.query_runner.mysql  )"
    id: $$cap_enabled_query_runners
    label: REDASH_ENABLED_QUERY_RUNNERS
  - defaultValue: ''
    description: Comma-separated list of non-default query runners to be enabled
    id: $$cap_additional_query_runners
    label: REDASH_ADDITIONAL_QUERY_RUNNERS
  - defaultValue: ''
    description: Comma-separated list of query runners that will not appear in Redash
    id: $$cap_disabled_query_runners
    label: REDASH_DISABLED_QUERY_RUNNERS
  - defaultValue: None
    description: Time limit for scheduled queries (in seconds)
    id: $$cap_scheduled_query_time_limit
    label: REDASH_SCHEDULED_QUERY_TIME_LIMIT
  - defaultValue: None
    description: Time limit for adhoc queries (in seconds)
    id: $$cap_adhoc_query_time_limit
    label: REDASH_ADHOC_QUERY_TIME_LIMIT
  - defaultValue: "','.join(default_destinations)"
    description: "Comma-separated list of alert destinations to be enabled (e.g.\_\
      redash.destinations.email,redash.destinations.slack )"
    id: $$cap_enabled_destinations
    label: REDASH_ENABLED_DESTINATIONS
  - defaultValue: ''
    description: Comma-separated list of non-default alert destinations to be enabled
    id: $$cap_additional_destinations
    label: REDASH_ADDITIONAL_DESTINATIONS
  - defaultValue: ''
    description: Comma-separated list of webhook URLs that to which events will be
      forwarded
    id: $$cap_event_reporting_webhooks
    label: REDASH_EVENT_REPORTING_WEBHOOKS
  - defaultValue: ''
    description: ''
    id: $$cap_sentry_dsn
    label: REDASH_SENTRY_DSN
  - defaultValue: 'FALSE'
    description: Disable sanitization of text input, allowing full HTML
    id: $$cap_allow_scripts_in_user_input
    label: REDASH_ALLOW_SCRIPTS_IN_USER_INPUT
  - defaultValue: 60,300,600,180,036,000,000,000,000
    description: Comma-separated list of integer seconds that will be allowed for
      dashboard refresh
    id: $$cap_dashboard_refresh_intervals
    label: REDASH_DASHBOARD_REFRESH_INTERVALS
  - defaultValue: 60, 300, 600, 900, 1800, 3600, 7200, 10800, 14400, 18000, 21600,
      25200, 28800, 32400, 36000, 39600, 43200, 86400, 604800, 1209600, 2592000
    description: Comma-separated list of integer seconds that will be allowed for
      scheduled query refresh
    id: $$cap_query_refresh_intervals
    label: REDASH_QUERY_REFRESH_INTERVALS
  - defaultValue: 'TRUE'
    description: Toggle to allow password login. Often disabled if Google Login, SAML,
      LDAP, or REMOTEUSERLOGIN are enabled.
    id: $$cap_password_login_enabled
    label: REDASH_PASSWORD_LOGIN_ENABLED
  - defaultValue: ''
    description: ''
    id: $$cap_saml_metadata_url
    label: REDASH_SAML_METADATA_URL
  - defaultValue: ''
    description: ''
    id: $$cap_saml_entity_id
    label: REDASH_SAML_ENTITY_ID
  - defaultValue: ''
    description: ''
    id: $$cap_saml_nameid_format
    label: REDASH_SAML_NAMEID_FORMAT
  - defaultValue: DD/MM/YY
    description: Moment.js format to be used throughout the web application
    id: $$cap_date_format
    label: REDASH_DATE_FORMAT
  - defaultValue: 'FALSE'
    description: ''
    id: $$cap_jwt_login_enabled
    label: REDASH_JWT_LOGIN_ENABLED
  - defaultValue: ''
    description: ''
    id: $$cap_jwt_auth_issuer
    label: REDASH_JWT_AUTH_ISSUER
  - defaultValue: ''
    description: ''
    id: $$cap_jwt_auth_public_certs_url
    label: REDASH_JWT_AUTH_PUBLIC_CERTS_URL
  - defaultValue: ''
    description: ''
    id: $$cap_jwt_auth_audience
    label: REDASH_JWT_AUTH_AUDIENCE
  - defaultValue: HS256,RS256,ES256
    description: ''
    id: $$cap_jwt_auth_algorithms
    label: REDASH_JWT_AUTH_ALGORITHMS
  - defaultValue: ''
    description: ''
    id: $$cap_jwt_auth_cookie_name
    label: REDASH_JWT_AUTH_COOKIE_NAME
  - defaultValue: ''
    description: ''
    id: $$cap_jwt_auth_header_name
    label: REDASH_JWT_AUTH_HEADER_NAME
  - defaultValue: 'TRUE'
    description: Disable/enable showing count of query results in status
    id: $$cap_feature_show_query_results_count
    label: REDASH_FEATURE_SHOW_QUERY_RESULTS_COUNT
  - defaultValue: 'TRUE'
    description: Toggle whether to periodically check if a newer version of Redash
      is available.
    id: $$cap_version_check
    label: REDASH_VERSION_CHECK
  - defaultValue: 'FALSE'
    description: Disable scheduled query execution
    id: $$cap_feature_disable_refresh_queries
    label: REDASH_FEATURE_DISABLE_REFRESH_QUERIES
  - defaultValue: 'FALSE'
    description: Enable experimental multiple owners support
    id: $$cap_feature_show_permissions_control
    label: REDASH_FEATURE_SHOW_PERMISSIONS_CONTROL
  - defaultValue: 'FALSE'
    description: "Enable the custom visualization option. This appears as a sub-type  of 'Chart' visualizations in the UI."
    id: $$cap_feature_allow_custom_js_visualizations
    label: REDASH_FEATURE_ALLOW_CUSTOM_JS_VISUALIZATIONS
  - defaultValue: 'TRUE'
    description: "Automatically publish a new query after its name is changed from  'New Query'"
    id: $$cap_feature_auto_publish_named_queries
    label: REDASH_FEATURE_AUTO_PUBLISH_NAMED_QUERIES
  - defaultValue: '600'
    description: HTTP timeout for the BigQuery query runner
    id: $$cap_bigquery_http_timeout
    label: REDASH_BIGQUERY_HTTP_TIMEOUT
  - defaultValue: 'FALSE'
    description: Enable showing the size of each table in the schema browser.
    id: $$cap_schema_run_table_size_calculations
    label: REDASH_SCHEMA_RUN_TABLE_SIZE_CALCULATIONS
  - defaultValue: '4'
    description: How many processes will gunicorn spawn to handle web requests
    id: $$cap_web_workers
    label: REDASH_WEB_WORKERS
captainVersion: '4'
services:
  $$cap_appname:
    caproverExtra:
      containerHttpPort: '5000'
    environment:
    - REDASH_ADDITIONAL_DESTINATIONS=$$cap_additional_destinations
    - REDASH_ADDITIONAL_QUERY_RUNNERS=$$cap_additional_query_runners
    - REDASH_ADHOC_QUERY_TIME_LIMIT=$$cap_adhoc_query_time_limit
    - REDASH_ALERTS_DEFAULT_MAIL_SUBJECT_TEMPLATE=$$cap_alerts_default_mail_subject_template
    - REDASH_ALLOW_SCRIPTS_IN_USER_INPUT=$$cap_allow_scripts_in_user_input
    - REDASH_AUTH_TYPE=$$cap_auth_type
    - REDASH_BIGQUERY_HTTP_TIMEOUT=$$cap_bigquery_http_timeout
    - REDASH_BLOCKED_DOMAINS=$$cap_blocked_domains
    - REDASH_COOKIE_SECRET=$$cap_cookie_secret
    - REDASH_CORS_ACCESS_CONTROL_ALLOW_CREDENTIALS=$$cap_cors_access_control_allow_credentials
    - REDASH_CORS_ACCESS_CONTROL_ALLOW_HEADERS=$$cap_cors_access_control_allow_headers
    - REDASH_CORS_ACCESS_CONTROL_ALLOW_ORIGIN=$$cap_cors_access_control_allow_origin
    - REDASH_CORS_ACCESS_CONTROL_REQUEST_METHOD=$$cap_cors_access_control_request_method
    - REDASH_DASHBOARD_REFRESH_INTERVALS=$$cap_dashboard_refresh_intervals
    - REDASH_DATABASE_URL=$$cap_database_url
    - REDASH_DATE_FORMAT=$$cap_date_format
    - REDASH_DISABLE_PUBLIC_URLS=$$cap_disable_public_urls
    - REDASH_DISABLED_QUERY_RUNNERS=$$cap_disabled_query_runners
    - REDASH_ENABLED_DESTINATIONS=$$cap_enabled_destinations
    - REDASH_ENABLED_QUERY_RUNNERS=$$cap_enabled_query_runners
    - REDASH_ENFORCE_HTTPS=$$cap_enforce_https
    - REDASH_EVENT_REPORTING_WEBHOOKS=$$cap_event_reporting_webhooks
    - REDASH_FEATURE_ALLOW_CUSTOM_JS_VISUALIZATIONS=$$cap_feature_allow_custom_js_visualizations
    - REDASH_FEATURE_AUTO_PUBLISH_NAMED_QUERIES=$$cap_feature_auto_publish_named_queries
    - REDASH_FEATURE_DISABLE_REFRESH_QUERIES=$$cap_feature_disable_refresh_queries
    - REDASH_FEATURE_SHOW_PERMISSIONS_CONTROL=$$cap_feature_show_permissions_control
    - REDASH_FEATURE_SHOW_QUERY_RESULTS_COUNT=$$cap_feature_show_query_results_count
    - REDASH_GOOGLE_CLIENT_ID=$$cap_google_client_id
    - REDASH_GOOGLE_CLIENT_SECRET=$$cap_google_client_secret
    - REDASH_HOST=$$cap_host
    - REDASH_INVITATION_TOKEN_MAX_AGE=$$cap_invitation_token_max_age
    - REDASH_JOB_EXPIRY_TIME=$$cap_job_expiry_time
    - REDASH_JWT_AUTH_ALGORITHMS=$$cap_jwt_auth_algorithms
    - REDASH_JWT_AUTH_AUDIENCE=$$cap_jwt_auth_audience
    - REDASH_JWT_AUTH_COOKIE_NAME=$$cap_jwt_auth_cookie_name
    - REDASH_JWT_AUTH_HEADER_NAME=$$cap_jwt_auth_header_name
    - REDASH_JWT_AUTH_ISSUER=$$cap_jwt_auth_issuer
    - REDASH_JWT_AUTH_PUBLIC_CERTS_URL=$$cap_jwt_auth_public_certs_url
    - REDASH_JWT_LOGIN_ENABLED=$$cap_jwt_login_enabled
    - REDASH_LDAP_BIND_DN_PASSWORD=$$cap_ldap_bind_dn_password
    - REDASH_LDAP_BIND_DN=$$cap_ldap_bind_dn
    - REDASH_LDAP_CUSTOM_USERNAME_PROMPT=$$cap_ldap_custom_username_prompt
    - REDASH_LDAP_DISPLAY_NAME_KEY=$$cap_ldap_display_name_key
    - REDASH_LDAP_EMAIL_KEY=$$cap_ldap_email_key
    - REDASH_LDAP_LOGIN_ENABLED=$$cap_ldap_login_enabled
    - REDASH_LDAP_SEARCH_DN=$$cap_ldap_search_dn
    - REDASH_LDAP_SEARCH_TEMPLATE=$$cap_ldap_search_template
    - REDASH_LDAP_URL=$$cap_ldap_url
    - REDASH_LIMITER_STORAGE=$$cap_limiter_storage
    - REDASH_LOG_LEVEL=$$cap_log_level
    - REDASH_MAIL_ASCII_ATTACHMENTS=$$cap_mail_ascii_attachments
    - REDASH_MAIL_DEFAULT_SENDER=$$cap_mail_default_sender
    - REDASH_MAIL_MAX_EMAILS=$$cap_mail_max_emails
    - REDASH_MAIL_PASSWORD=$$cap_mail_password
    - REDASH_MAIL_PORT=$$cap_mail_port
    - REDASH_MAIL_SERVER=$$cap_mail_server
    - REDASH_MAIL_USE_SSL=$$cap_mail_use_ssl
    - REDASH_MAIL_USE_TLS=$$cap_mail_use_tls
    - REDASH_MAIL_USERNAME=$$cap_mail_username
    - REDASH_MULTI_ORG=$$cap_multi_org
    - REDASH_PASSWORD_LOGIN_ENABLED=$$cap_password_login_enabled
    - REDASH_PROXIES_COUNT=$$cap_proxies_count
    - REDASH_QUERY_REFRESH_INTERVALS=$$cap_query_refresh_intervals
    - REDASH_QUERY_RESULTS_CLEANUP_COUNT=$$cap_query_results_cleanup_count
    - REDASH_QUERY_RESULTS_CLEANUP_ENABLED=$$cap_query_results_cleanup_enabled
    - REDASH_QUERY_RESULTS_CLEANUP_MAX_AGE=$$cap_query_results_cleanup_max_age
    - REDASH_REDIS_URL=$$cap_redis_url
    - REDASH_REMOTE_USER_HEADER=$$cap_remote_user_header
    - REDASH_REMOTE_USER_LOGIN_ENABLED=$$cap_remote_user_login_enabled
    - REDASH_SAML_ENTITY_ID=$$cap_saml_entity_id
    - REDASH_SAML_METADATA_URL=$$cap_saml_metadata_url
    - REDASH_SAML_NAMEID_FORMAT=$$cap_saml_nameid_format
    - REDASH_SCHEDULED_QUERY_TIME_LIMIT=$$cap_scheduled_query_time_limit
    - REDASH_SCHEMA_RUN_TABLE_SIZE_CALCULATIONS=$$cap_schema_run_table_size_calculations
    - REDASH_SCHEMAS_REFRESH_SCHEDULE=$$cap_schemas_refresh_schedule
    - REDASH_SENTRY_DSN=$$cap_sentry_dsn
    - REDASH_STATIC_ASSETS_PATH=$$cap_static_assets_path
    - REDASH_STATSD_HOST=$$cap_statsd_host
    - REDASH_STATSD_PORT=$$cap_statsd_port
    - REDASH_STATSD_PREFIX=$$cap_statsd_prefix
    - REDASH_STATSD_USE_TAGS=$$cap_statsd_use_tags
    - REDASH_THROTTLE_LOGIN_PATTERN=$$cap_throttle_login_pattern
    - REDASH_VERSION_CHECK=$$cap_version_check
    - REDASH_WEB_WORKERS=$$cap_web_workers

    image: redash:$$cap_app_version
    volumes:
    - $$cap_appname-data:/data/redash
  adhoc_worker:
    command:
    - worker
    depends_on:
      postgres
      redis
    environment:
      - QUEUES='queries'
      - WORKERS_COUNT="2"
    image: redash/redash:$$cap_app_version
    restart: always
  postgres:
    environment:
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_USER: postgres
    image: postgres:15.1-bullseye
    restart: always
    volumes:
    - postgres-data:/var/lib/postgresql/data
  redis:
    image: redis/redis-stack-server:7.0.2-RC4
    restart: always
    volumes:
      - redis-data:/data
  scheduled_worker:
    command:
    - worker
    depends_on:
      postgres
      redis
    environment:
      - QUEUES='scheduled_queries,schemas'
      - WORKERS_COUNT=1
    image: redash/redash:$$cap_app_version
    restart: always
  scheduler:
    command:
    - scheduler
    depends_on:
      postgres
      redis
    environment:
      - QUEUES='celery'
      - WORKERS_COUNT=1
    image: redash/redash:$$cap_app_version
    restart: always
  server:
    command:
    - server
    depends_on:
      postgres
      redis
    environment:
      REDASH_WEB_WORKERS: 4
    image: redash/redash:$$cap_app_version
    ports:
    - mode: ingress
      target: 5000
      published: 5000
      protocol: tcp
    restart: always
  worker:
    command:
    - worker
    depends_on:
      postgres
      redis
    environment:
      - QUEUES='periodic emails default'
      - WORKERS_COUNT=1
    image: redash/redash:$$cap_app_version
    restart: always